<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>libpandac: Hardware tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libpandac
   &#160;<span id="projectnumber">0.0.0</span>
   </div>
   <div id="projectbrief">A library designed for a comm.ai Panda.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Hardware tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Table of Contents</h1>
<ul>
<li><a href="#about">About</a></li>
<li><a href="#hardware">Hardware</a><ul>
<li><a href="#hardware-list">List of Components</a><ul>
<li><a href="#hardware-req">Required</a></li>
<li><a href="#hardware-opt">Optional</a></li>
<li><a href="#hardware-opt">Optional Power</a></li>
</ul>
</li>
<li><a href="#hardware-config">Configuration</a><ul>
<li><a href="#hardware-rav4">Toyota RAV4</a></li>
<li><a href="#hardware-pilot">Honda Pilot</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#software">Software</a><ul>
<li><a href="#software-OS">Ubuntu 18.04 LTS</a></li>
<li><a href="#libpanda-setup">libpanda Setup</a></li>
</ul>
</li>
<li><a href="#software-guide">Software Guide</a><ul>
<li><a href="#libpanda-services">libpanda Services</a></li>
<li><a href="#libpanda-utilities">libpanda Utilities</a><ul>
<li><a href="#libpanda-pandacord">pandacord</a></li>
<li><a href="#libpanda-pandaSetSystemTime">pandaSetSystemTime</a></li>
<li><a href="#libpanda-pandaCurses">pandaCurses</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#power-guide">Power Guide with x728</a></li>
<li><a href="#network-guide">Network Guide</a></li>
<li><a href="#visualization">Data Visualization</a></li>
<li><a href="#repository">Data Repository</a></li>
</ul>
<p><a class="anchor" id="about"></a> </p><hr/>
 <h1>About</h1>
<p>Libpanda is a software library and set of utilities intended to interface with vehicles via comma.ai's <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> and optional Giraffe. The source for the library is located here:</p>
<p><a href="https://github.com/jmscslgroup/libpanda">https://github.com/jmscslgroup/libpanda</a></p>
<p>Full Raspbian-based images with ROS/libpanda preinstalled can be found here:</p>
<p>https://github.com/jmscslgroup/libpanda/blob/master/doc/image.md "https://github.com/jmscslgroup/libpanda/blob/master/doc/image.md"</p>
<p>The majority of example source code to interface with the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> is based on python and uses libusb. We chose to write our own C++ version due to performance issues found with minimalist implementations in Python. This effects both CPU usage nearing 92%, and missing nearly 50% of CAN data. Libpanda is able to perform the same tasks as the Python version, with the addition of reading GPS data, at 35% usage, and with twice the throughput of data collection. These tests were performed on a Raspberry Pi 4. Here is a video demonstrating our findings:</p>
<p> 
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/GavbXC_aOCY?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<blockquote class="doxtable">
<p>Note: After the video was recorded some small tuning resulted in CPU usage closer to 35% instead of 50% </p>
</blockquote>
<p><a class="anchor" id="hardware"></a> </p><hr/>
 <h1>Hardware</h1>
<p><a class="anchor" id="hardware-list"></a> </p><hr/>
 <h2>List of Components</h2>
<p>The hardware choice is based around running linux with comm.ai hardware, leveraging prior efforts in CAN bus access.</p>
<div class="image">
<img src="overview.png" alt="overview.png"/>
<div class="caption">
Hardware Overview</div></div>
<p> <a class="anchor" id="hardware-req"></a></p>
<p>Both the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> and Grey Panda(discontinued) is supported by libpanda. It is recommended to use the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> since it can do everything the Grey <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> can do, but also can connect to the Car's OBD II port. This means that the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> is capable of reading 3 total CAN busses for information, whereas the Grey <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> can only listen to 2 CAN busses. Comma.ai also sells a White <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> which features no GPS but WiFi instead. Libpanda will be able to work with the White <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> over USB and will diasble GPS methods, however it is not listed as a supported device due to libpanda's lack of WiFi connection support.</p>
<h4>Required for Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>:</h4>
<ul>
<li><a href="https://comma.ai/shop/products/panda-obd-ii-dongle">comma.ai Car Harness</a></li>
</ul>
<p>Be sure to select the "Black Panda" option when ordering the Car Harness. Also very importantly, read the <a href="#hardware-config">Hardware Configuration</a> section to understand how <b>the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> may brick your computer if not understood completely</b>.</p>
<h4>Required for Grey <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> (discontinued):</h4>
<p>If you have the Grey Panda/Giraffe it is still supported by libpanda, however it has been discontinued and is no longer available for purchase.</p>
<h4>Recommended Computer Hardware:</h4>
<p>Libpanda may be able to work on most linux machines, however the following hardware list is what is used for development and hould eliminate concerns of portability.</p>
<ul>
<li><a href="https://www.amazon.com/Raspberry-Model-2019-Quad-Bluetooth/dp/B07TD42S27/ref=sxin_2_ac_d_pm?ac_md=4-0-VW5kZXIgJDUw-ac_d_pm&amp;cv_ct_cx=raspberry+pi+4&amp;keywords=raspberry+pi+4&amp;pd_rd_i=B07TD42S27&amp;pd_rd_r=897fc6f0-a9d6-430f-8811-c07c3c7b9e19&amp;pd_rd_w=K0xrG&amp;pd_rd_wg=WSCdw&amp;pf_rd_p=0e223c60-bcf8-4663-98f3-da892fbd4372&amp;pf_rd_r=AGXA47R72X2ZKA2F8X3Z&amp;psc=1&amp;qid=1583948920">Raspberry Pi 4GB</a></li>
<li><a href="https://www.amazon.com/Samsung-Class-Adapter-MB-MC64DA-AM/dp/B01273JZMG?tag=androidcentralb-20&amp;ascsubtag=UUacUdUnU77910YYwYg">64GB SD card</a></li>
<li><a href="https://www.amazon.com/Anker-Powerline-Pull-up-Resistor-Samsung/dp/B01A6F3WHG/ref=sr_1_5?keywords=usb+3+to+usb+C&amp;qid=1583954394&amp;s=electronics&amp;sr=1-5">USB 2.0/3.0 to USB C adapter cable for power</a></li>
<li><a href="https://www.amazon.com/NIMASO-Double-Compatible-External-Player/dp/B08DK8RPRW/">USB A to A to connect Pi to Panda</a></li>
<li><p class="startli"><a href="https://www.adafruit.com/product/3195">Pimoroni Blinkt!</a></p>
<p class="startli">This is a nifty, inexpensive, and compact set of addressable LEDs that will be supported for displaying the state of various scripting components such as WiFi connectivity, data upload, and power states, but is not required for any functionality.</p>
</li>
</ul>
<p><a class="anchor" id="hardware-opt"></a> </p><h4>Optional:</h4>
<p>These items are for convenience and will not change the function of the baove hardware, but may be needed if you are new to using a Raspberry Pi.</p>
<ul>
<li><a href="https://www.amazon.com/Vanja-Adapter-Portable-Memory-Reader/dp/B00W02VHM6/ref=sr_1_6?keywords=usb+sd+card&amp;qid=1583949114&amp;s=electronics&amp;sr=1-6">SD Card reader for Ubuntu flashing</a></li>
<li><a href="https://www.amazon.com/GANA-Adapter-Female-Action-Supported/dp/B07K21HSQX/ref=sxin_2_ac_d_pm?ac_md=1-0-VW5kZXIgJDEw-ac_d_pm&amp;cv_ct_cx=micro+hdmi&amp;keywords=micro+hdmi&amp;pd_rd_i=B07K21HSQX&amp;pd_rd_r=b124f42c-a587-491e-9400-52aef81c3d88&amp;pd_rd_w=mNPkI&amp;pd_rd_wg=saxZx&amp;pf_rd_p=0e223c60-bcf8-4663-98f3-da892fbd4372&amp;pf_rd_r=J1YKVHPV73CBGDNP1MXZ&amp;psc=1&amp;qid=1583949163&amp;s=electronics">Micro HDMI adapter for Pi 4</a></li>
<li><a href="https://www.amazon.com/AmazonBasics-RJ45-Cat-6-Ethernet-Patch-Cable-10-Feet-3-Meters/dp/B00N2VIALK/ref=sr_1_3?keywords=ethernet&amp;qid=1583954176&amp;sr=8-3">Ethernet Cable</a></li>
</ul>
<p><a class="anchor" id="hardware-opt-power"></a> </p><h4>Optional power for data collection</h4>
<ul>
<li><a href="https://www.amazon.com/Geekworm-Raspberry-Management-Detection-Shutdown/dp/B087FXLZZH">x728 Raspebrry Pi UPS</a></li>
<li><a href="https://www.amazon.com/liogea-LG3400G-3400mAh-Rechargeable-Batteries/dp/B07YBTQSQL/ref=sr_1_2?keywords=18650b&amp;qid=1585673515&amp;s=electronics&amp;sr=1-2">18650 Batteries with no built-in protection, qty 2 per x750</a></li>
</ul>
<p>The x728 and batteries are shown as optional since they are not required to record data, nor needed for future control of the vehicle. They will allow for the automatic data-upload upon power shut-down from the vehicle by maintaining power to the Pi, which will be able to detect the new power state and invoke a CyVerse data synchronization before shutting itself down.</p>
<p>There are multiple ways to power the x728 board in a car that can make use of automatic data upload scripts. The most important part for functionality as intended is that the power source turns off when the car is turned off.</p>
<h5>Fast Charge w/Debugging (most expensive)</h5>
<p>For fastest charging at 3A, and for power debugging, the following list provides power information when in use. This list requires a small amount of assembly.</p>
<ul>
<li><a href="https://www.amazon.com/gp/product/B07JZ2GQJF/ref=ppx_yo_dt_b_asin_title_o04_s00?ie=UTF8&amp;psc=1">DROK DC Buck Module with Display</a></li>
<li><a href="https://www.amazon.com/gp/product/B01HGO2OIS/ref=ppx_yo_dt_b_asin_title_o04_s00?ie=UTF8&amp;psc=1">Cigarette Lighter Plug with Cable</a></li>
<li><a href="https://www.amazon.com/gp/product/B07VPHMLHC/ref=ppx_yo_dt_b_asin_title_o04_s00?ie=UTF8&amp;psc=1">2.5mm x 5.5mm Coaxial power plug</a></li>
</ul>
<blockquote class="doxtable">
<p>Note: The 2.5mm x 5.5mm uses 22 AWG wire shich may be too small for 3A charging, yet to be evaluated. </p>
</blockquote>
<h5>Fast Charge</h5>
<p>For full 3A charging using USB with minimal install, you can use a a USB to 5.5mmx2.5mm barrel jack cable with higher current cigarette lighter USB source</p><ul>
<li><a href="https://www.amazon.com/TENINYU-Angled-Degree-5-5x2-5mm-Positive/dp/B07B11VK4S/ref=sr_1_2?keywords=usb+to+2.5mm+5.5+male&amp;qid=1585767229&amp;s=electronics&amp;sr=1-2">USB to 5.5x2.5mm Adapter</a></li>
<li><a href="https://www.amazon.com/Charger-RAVPower-Adapter-iSmart-Compatible/dp/B071FHZRQN/ref=sr_1_2?keywords=cigarrete+usb&amp;qid=1585767324&amp;s=electronics&amp;sr=1-2">Cigarette Ligheter to USB adapter, 4.8A</a></li>
</ul>
<h5>Inexpensive (Slowest Charge)</h5>
<p>Alternatively, if your vehicle has USB ports that turn off when the car is shut off, then you may use a USB mini cable with a maximum supported charge current of 2A.</p><ul>
<li><a href="https://www.amazon.com/Premium-Super-Durable-Android-Smartphones-Tablets/dp/B076WXJPQ1/ref=sr_1_4?keywords=usb+micro&amp;qid=1585767182&amp;sr=8-4">USB mini cable (3-pack)</a></li>
</ul>
<p><a class="anchor" id="hardware-config"></a> </p><hr/>
 <h2>Configuration</h2>
<p>The <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> serves as a bridge between the vehicle's CAN bus and USB. The Grey <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> uses a standard OBD II connector whereas the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> interfaces using special connectors. The OBD port is a standardized connector guaranteed to be on any car newer than 1996 for emmissions pruproses. This means that the Grey/White <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> can connect to any car, however some caveats to this have been noted:</p>
<ul>
<li>On a 2009 Ford Hybrid Escape, CAN data can be read but the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> causes an electrical issue resulting in disabling the dash, locks, and creature comforts.</li>
<li>On a 2003 Jeep Grand Cherokee, the car runs normally but no CAN data can be read. Also, the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> USB interface connection fails on car starting.</li>
</ul>
<p>With this in mind, be cautious on the car that you wish to plug the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> into, as the connector may be standardized but the pinout varies. It is safest to only collect data on cars supported by comma.ai.</p>
<h4>Grey <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> with Giraffe</h4>
<p>&gt;Note: The Grey <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> has been discontinued but this information will remain for those that still have the Grey/Giraffe setup.</p>
<p>The OBD II port is intended for emmissions and mechanic diagnostics. In order to read lower-level data, the Giraffe exposes deeped CAN buses and adapts them to an OBD II port. This enables reading of a vehicle's Radar data. The Giraffe also feature DIP switches for setting different modes, including enabling writing to the CAN bus for vehicel control. Currently we have the DIP switches are configures as follows:</p>
<div class="image">
<img src="dip.jpg" alt="dip.jpg"/>
<div class="caption">
Giraffe DIP switch configuration: ON:(1,3,4) OFF:(2)</div></div>
 <h4>Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> with Car Harness</h4>
<p>The Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> does not feature any DIP switches, but the associated Car Harness, if matched to the vehicle, should be all that is needed. There is a caveat to the installation of the black panda when not using comma.ai's EON. First let's discuss the power methodology regarding the Black Panda/Car Harness/EON intended use case:</p>
<ul>
<li>The EON is a rooted phone, featuring a single USB connector that is intended for normal charging. This charging is usually power provided by the host computer to the client USB device.</li>
<li>The EON features USB OTG functionality, meaning that the phone can act a USB host. The phone however still needs to charge.</li>
<li>The Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> is a USB client device, but has been engineered to provide back-power to the EON to power the host by getting power through the Car Harness.</li>
<li>This project, using libpanda, is intended to run on a Raspberry Pi which provides power to the client device.</li>
<li>Thus there is a conflict where both the Raspberry Pi (or other computer) is trying to drive the USB power pins along with the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>.</li>
</ul>
<p>&gt;Note: The above items were found out by assuming that the USB connectors followed standard protocols but this is <b>very importantly not the case</b>. <b>Thus to make use of the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>, modification or special parts must be ordered to not cause any hardware failure</b>.</p>
<p>Fortunately htere are a few workarounds that will let you safely make use of the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>.</p>
<h4>Purchasing an Adapter:</h4>
<p>The least invasive method is to purchase a cable that has only the data lines connected. These are however difficult to comeby. One example of a cable is <a href="https://www.amazon.com/dp/B07T9BRNHW/ref=sspa_dk_detail_5?psc=1&amp;pd_rd_i=B07T9BRNHW&amp;pd_rd_w=L4Rlk&amp;pf_rd_p=48d372c1-f7e1-4b8b-9d02-4bd86f5158c5&amp;pd_rd_wg=TWwR4&amp;pf_rd_r=46V14Z53DTJWNP6WXF3Q&amp;pd_rd_r=5f3b21c8-2c73-4df3-a883-129fbd9c115a&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUExTlZMTDJIU1JXVVY4JmVuY3J5cHRlZElkPUEwMDAxMDA3MVQ2QlFZN0lORTVWOCZlbmNyeXB0ZWRBZElkPUEwMzY4MzU0MTBNRDJQQkpWRkdVTSZ3aWRnZXROYW1lPXNwX2RldGFpbCZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=">this power-switchable cable</a>, however please keep in mind that you must ensure that the switch is never accidentally flipped. Also, this means that a person new tot he Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> may be unaware of the cables importance, bypass the cable, and cause hardware damage.</p>
<h4>Using Scotch Tape on the USB Cable:</h4>
<p>A simple solution without the purchase of a separate adapter that can be easily done at home is to tape-off the +5V line in the USB cable. In the following image, you can see the placement of the tape within the cable. This end may be plugged into either the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> or the Raspberry Pi. This method is non-invasive and easily reversible. To read more about the pinouts with USB type A connectors, refer to <a href="https://www.electroschematics.com/usb-how-things-work/?utm_referrer=https%3A%2F%2Fwww.google.com">this website</a>. This method also has the same issue as using the adapter method above regarding having knowledge about the cable, but even moreso since the cable change with tape is subtle. A person could potentially swap out cables without realizing the tape is on the old cable, causing hardware damage.</p>
<div class="image">
<img src="tapedUSB.png" alt="tapedUSB.png"/>
<div class="caption">
Tape on the +5V pin on one end of a USB cable for the Black Panda</div></div>
 <h4>Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> Modification:</h4>
<p>As with the scotch-tape method above, this method involves disconencting power but through a more invasive method. Again, <a href="https://www.electroschematics.com/usb-how-things-work/?utm_referrer=https%3A%2F%2Fwww.google.com">this website</a> should be read regarding pinouts to understand what this modification does. This method involves the disassembly of the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> to sever the +5V line directly on the USB connector. Fortunately this can be done in a number of ways, using some snipping tool or a soldering iron, and disassembly is a breeze. I personally prefer this method to the above two since this will ensure that the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> will never be able to fry a computer. Also depending on the method of modification, this may be reversible using a soldering iron. The following image shows the steps to modify the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>:</p>
<div class="image">
<img src="modification.png" alt="modification.png"/>
<div class="caption">
Black Panda Power Modification</div></div>
<ol type="1">
<li>Peel back the tape until the seam is exposed.</li>
<li>Slide the two halves apart as shown. Be careful of the GPS antenna cable.</li>
<li>Use a USB cable or other blunt object to aid in sliding the PCB out of the casing.</li>
<li>Remove the USB cable after the board slides a bit</li>
<li>Slide the PCB out of the case</li>
<li>Locate the USB A +5V power pin. You may use a tool to sever the connection and bend the pins out of the way. In the photo, a tool is used to pry the pin out of the USB housing.</li>
<li>Furhter prying shown, witht he pin coming out of the connector.</li>
<li>The solder joint may break, but the pin is fully removed and the Black <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>, with any cable, is now incapable of breaking a computer.</li>
</ol>
<p>Reassmbly may be done by following steps 1, 2, and 5 in reverse.</p>
<h4>Vehicle Specific Information</h4>
<p><a class="anchor" id="hardware-rav4"></a> </p><h3>Installation in Toyota RAV4 2019</h3>
<p> 
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/N2x18QqpV5s?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<p><a class="anchor" id="hardware-pilot"></a> </p><h3>Installation in Honda Pilot 2017</h3>
<p>TBD</p>
<p><a class="anchor" id="software"></a> </p><hr/>
 <h1>Software</h1>
<p><a class="anchor" id="software-OS"></a> </p><hr/>
<div class="image">
<img src="ubuntu.jpg" alt="ubuntu.jpg"/>
</div>
 <h2>Ubuntu 18.04 LTS</h2>
<p>Currently Ubuntu 18.04 LTS is the only supported OS though it is very possible that libpanda will work just fine on other *nix based platforms. To install Ubuntu 18.04 LTS on the Raspberry Pi 4, you will need a method to write to micro SD cards (see <a href="#hardware-optional">Optional Hardware</a>). Follow the tutorial on Ubuntu's website for downloding and flashing based on your own OS:</p>
<ul>
<li><a href="https://ubuntu.com/download/raspberry-pi">Ubuntu 18.04 LTS Raspberry Pi 4 Installation Guide</a></li>
</ul>
<p>Once the OS is flashed, insert the SD card into the Pi 4. Ethernet is by default enabled with a DHCP client. There are two ways to configure the Pi 4 from this point, either by plugging in a keyboard and monitor using the HDMI adapter from the <a href="#hardware-optional">Optional Hardware</a>, or through the preinstalled SSH server. The default credentials for this image are:</p>
<ul>
<li>Username: ubuntu</li>
<li>Password: ubuntu</li>
</ul>
<p>The default username can be changed, but is out of scope for this tutorial.</p>
<h3>Setup via Monitor and Keyboard (Easy but clunky)</h3>
<ol type="1">
<li>Hook up monitor and keyboard</li>
<li>Power the Pi via the USB C connector</li>
<li>On boot, enter the credentials</li>
<li>Follow the instructions to enter a new password</li>
</ol>
<h3>Setup via Ethernet and SSH (Difficult but with minimal extra hardware)</h3>
<ol type="1">
<li>Plug in an ethernet cable</li>
<li>Power the Pi via the USB C connector</li>
<li>Wait a few minutes, then get the Pi's IP from your router</li>
<li>SSH into the pi. You may use PuTTY on Windows, or on a *nix system (including macOS): <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ssh ubuntu@&lt;your Pi&#39;s IP&gt;</div></div><!-- fragment --></li>
<li>Follow instructions to change password</li>
<li>SSH in again with new password</li>
</ol>
<p>Here is an example of logging into a Pi after obtaining an IP address of 10.0.1.80:  
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/w7WJoFv7HlY?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<h2>Setup with IRODS iCommands</h2>
<h3>Install/setup iCommands</h3>
<p>Use <a href="https://cyverse.atlassian.net/wiki/spaces/DS/pages/241869823/Setting+Up+iCommands">this page</a> for tutorial on setting up iCommands on Linux, MacOC, or Windows.</p>
<h3>Setting up data upload</h3>
<p>If you have flashed an image with iRods installed, or you've installed it yourself, make sure to run the iinit command to setup your interface.</p><ol type="1">
<li>Run command: iinit</li>
<li>Host name: data.cyverse.org</li>
<li>Port: 1247</li>
<li>Username: [put your username for cyverse]</li>
<li>Zone: iplant</li>
<li>Password: [your password for cyverse]</li>
</ol>
<p>If you have an image with iCommands pre-installed, look for and run 'sudo ./setVin.sh' to set you VIN as an ID for your data files.</p>
<p><a class="anchor" id="libpanda-setup"></a> </p><hr/>
 <h2>libpanda Setup</h2>
<p>Libpanda is a multithreaded C++ based library for custom <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> interface applications using the observer based software design pattern (i.e. callbacks). Also featured in the software area set of premade data recording utilities, simple data visualizers, startup services, and network handling services. The utilities save CSV formatted data that is supported by Rahul Bhadani's <a href="https://github.com/jmscslgroup/strym">Strym</a>.</p>
<p>Installation requires an internet connection. Ethernet is the easiest form to provide internet. Once logged into your Pi 4 (either SSH or keyboard/monitor), try pinging Google's DNS server to check for receivng bytes from 8.8.8.8: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ping 8.8.8.8</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;64 bytes from 8.8.8.8: icmp_seq=1 ttl=56 time=25.6 ms</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;64 bytes from 8.8.8.8: icmp_seq=2 ttl=56 time=21.0 ms</div></div><!-- fragment --><p>If successful, run the following to download and install libpanda. This will take a few minutes to complete: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ git clone https://github.com/jmscslgroup/libpanda.git</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ cd libpanda</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$ sudo ./installpi4.sh </div></div><!-- fragment --><p> 
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/A3hyYB-Fy_U?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<blockquote class="doxtable">
<p>Note: The above video may show different results as development continues. </p>
</blockquote>
<p><a class="anchor" id="software-guide"></a> </p><hr/>
 <h1>Software Guide</h1>
<p><a class="anchor" id="libpanda-services"></a> </p><hr/>
 <h2>libpanda Services</h2>
<h3>About</h3>
<p>The [libpanda setup process](libpanda-setup) installs a set of startup scripts using linux's systemd. These scripts</p><ul>
<li>pandasettime - This opens the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>, waits for a GPS fix, then sets the Pi 4's system clock based on GPS time</li>
<li>pandarecord - This runs after pandasettime. Once the system clock is set, pandarecord opens the panda for data recording. This produces a set of CSV formatted files for both CAN and GPS data. All data is currently recorded into timestamped files and folders, which may be viewable here: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ cd /var/panda/CyverseData/JmscslgroupData/PandaData</div></div><!-- fragment --></li>
</ul>
<blockquote class="doxtable">
<p>Note: We currently are aware of an issue where when the Pi 4 is soft rebooted (i.e. sudo reboot), the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> device fails to be recognized. In the case of a hard boot (i.e. reconnecting Pi 4 power), this problem does not occur. In the following example, you can see how to check for Oanda USB connectivitiy by performing the command lsusb. This is the result afeter a soft boot, then the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> was reconnected, followed by andother lsusb to check for its presence. </p>
</blockquote>
<div class="image">
<img src="lsusb.jpg" alt="lsusb.jpg"/>
<div class="caption">
Using lsusb to check for the Panda device, device ID bbaa:ddcc</div></div>
 <h3>Checking Status</h3>
<p>Systemd provides a set of utilities to work with services. To check on the status of one of the above services: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ service pandasettime status</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ service pandarecord status</div></div><!-- fragment --><p> To exit the status check, press 'q'.  
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/qbSig0QSgKk?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<p>A similar command for checking status is journalctl. This may be run as follows: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ journalctl -f -u pandasettime</div></div><!-- fragment --><p>Press ctrl-c to exit journalctl.</p>
<h3>Fixing Errors</h3>
<p>These services should automatically start and take control of the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>. To run other utilities, you can manually stop a service, or start it up later. Restarting a service effectively performs a stop, then a start. Here are useful commands for this scenario: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo service pandasettime stop</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ sudo service pandasettime start</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$ sudo service pandasettime restart</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;$ sudo service pandarecord stop</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;$ sudo service pandarecord start</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;$ sudo service pandarecord restart</div></div><!-- fragment --><p>This is an example of when the services show a fialed status, and how to reset them:  
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mohtZnknESk?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<h3>Disabling Services</h3>
<p>If you are in a development environment then it can be annoying to have these services automatically take control fo the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>. In this case you can disable and later re-enable services by performing the following: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo service pandasettime disable</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ sudo service pandarecord disable</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$ sudo service pandasettime enable</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;$ sudo service pandarecord enable</div></div><!-- fragment --><p><a class="anchor" id="libpanda-utilities"></a> </p><hr/>
 <h2>libpanda Utilities</h2>
<p>In order to run the following utilities, ensure that no services are currently running that use the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>. For example on a fresh boot with services still enabled, run the following: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo service pandasettime stop</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ sudo service pandarecord stop</div></div><!-- fragment --><p>The error you may receive if the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> device is already in use will look similar to the following error: </p><div class="image">
<img src="libusb-busy.jpg" alt="libusb-busy.jpg"/>
<div class="caption">
Panda device busy by another process resulting ins LIBUSB_ERROR_BUSY </div></div>
<p> <a class="anchor" id="libpanda-pandacord"></a> </p><h3>pandacord</h3>
<p>This program is the same program invoked by the pandarecord systemd service. In the case of the systemd service, directories and filenames are hardcoded to a pre-defined directory. Running the service manually lets the user specify filenames. The following records CSV formatted data to the specified filenames in the current working directory: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo pandacord -g gpsData.csv -c canData.csv</div></div><!-- fragment --><p>To finish recording press ctrl-c. More options for file saving are possible by providing the "-h" argument.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo pandacord -h</div></div><!-- fragment --> <div class="image">
<img src="pandacord.jpg" alt="pandacord.jpg"/>
<div class="caption">
pandacord usage information </div></div>
<p> Here is a video showing a successful run of pandacord, however no CAN bus was physically conencted in this demonstration:  
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/DVjhZIUuJeI?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<p><a class="anchor" id="libpanda-pandaSetSystemTime"></a> </p><h3>pandaSetSystemTime</h3>
<p>As similar to pandacord, pandaSetSystemTime is the program invoked by the pandasettime systemd service. This program opens the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a>, continuously reads the GPS and waits for a fix, compares the system clock against GPS time, then resets the system clock if beyond an epsilon of 0.2 seconds.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo pandaSetSystemTime</div></div><!-- fragment --><p>  
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/L0e9RAOfZ9U?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<blockquote class="doxtable">
<p>Note: This video is showing an older method of invoking pandaSetSytemTime but provides the same output. </p>
</blockquote>
<p><a class="anchor" id="libpanda-pandaCurses"></a> </p><h3>pandaCurses</h3>
<p>pandaCurses is an example program that uses ncurses for viewing data-in-real-time (DIRT). Both GPS and CAN data are handled in different views. For GPS, all reported statistics, as configured by the the ublox m8030 are displayed. The CAN visualization is similar to eh *nix program "top", allowing for sorting of different metrics of live data. This program is not currently installed and needs run in a different manner. Data logging is also provided if the correct arguments are provided (see usage statement).</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ cd libpanda/build</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ ./pandaCurses -h # This displays the usage statement</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$ sudo ./pandaCurses</div></div><!-- fragment --><p>When run, pressing the 'g' key siwtches between view modes for GPS and CAN data.</p>
<p> 
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/qKrr3wVKoyA?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<blockquote class="doxtable">
<p>Note: In the above video example the argument "-f" was provided. This fakes CAN data for testing purposes and should not be used. This was used purely for demonstration. </p>
</blockquote>
<h5>pandaCurses GPS display</h5>
<div class="image">
<img src="gpscurses.jpg" alt="gpscurses.jpg"/>
<div class="caption">
pandaCurses GPS view</div></div>
<p> The GPS provides a simple display of the state reported by the GPS module after parsing NMEA messages. This may be used to assess the quality of antenna placement based on the current set of viewable satellites.</p>
<h5>pandaCurses CAN display</h5>
<div class="image">
<img src="cancurses.jpg" alt="cancurses.jpg"/>
<div class="caption">
pandaCurses CAN view</div></div>
<p> This represents a similar structure to the program "top". When in this view, the arrow keys can select a column and change the ordering (high-low or low-high) of the current column.</p>
<ul>
<li>MessageID represents the CAN message parsed ID.</li>
<li>Count represents the number of times a message with MessageID has been sent</li>
<li>Rate is the current rate of messages sent with MessageID</li>
<li>UniqueData represents the number of unique data sent with MessageID (see video below). Pressing '-' resets the count to 0.</li>
</ul>
<p>When a particular column is selected, the "Highlight Value:" fiel in the lower left lets the user type in a number for particualr data to be highlighted. Once a number is typed, press the "enter" key to perform the highlight. For MessageID, Count, and UniqueData, all current values matching "Highlight Value" will be immediately highlight, and persist even if the value changes. For Rate, this highlights anything withing +/-1 from "Highlight Value".</p>
<p>UniqueData is intended to be used for reverse-engineering of vehicle ocmponents. In the case of constantly changing data such as floating point values for engine status reports, UniqueData may not be an effective method. For messages that involve reporting discrete states, UniqueData can easily highlight messages that changed absed on interacting with the vehicle. The effective sequence of this interaction is as follows:</p>
<ol type="1">
<li>Reset UniqueData with '-'</li>
<li>Select the UniqueData column</li>
<li>Wait until an acceptable steady state is reached</li>
<li>Enter a value into the "Highlight Field", such as "1", then press enter to highlight data</li>
<li>Perform a simple interaction on the car, like pushing a single button, shifting gears, or pressing the brake</li>
<li>Observe values highlighted that no longer have UniqueData at 1, suggesting new data has been published as a result of the vehicle interraction.</li>
</ol>
<p> 
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kJtX92a0EbM?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<p><a class="anchor" id="power-guide"></a> </p><hr/>
 <h1>Power Guide with x728</h1>
<blockquote class="doxtable">
<p>Note: Do not follow the installation instructions provided by the manufacturer. We have provided an installation script that functions for our use case. </p>
</blockquote>
<div class="image">
<img src="x725.jpg" alt="x725.jpg"/>
<div class="caption">
x728 installed on the Raspberry Pi</div></div>
<p> The x728 is a battery backup solution for the Raspberry Pi, using GPIO pins 4, 17, and 18 along with i2c. The documentation of the particular hardware is a bit lacking, but the functionality is sufficient for data collection applications. Some preliminary data was taken in regard to charge/discharge times under expected use:</p>
<ul>
<li>With the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> plugged in while the OS is idle, power can be supplied for ~4 hours</li>
<li>With the <a class="el" href="namespace_panda.html" title="Handles USB communication and parsing with a comma.ai Panda. ">Panda</a> plugged in actively recording data at ~30% CPU usage, charge time is ~2.5 hours</li>
</ul>
<p>For use with the CIRCLES project, the installation script in libpanda-&gt;scripts-&gt;x728 sets up the necessary start scripts to automatically shut down the Pi in a safe manner. The statemachine for the boot process is shown in the following state diagram. The x728 allows the state machine to detect a power outage, then invoke the necessary scripts for wifi connectivity and cyverse data uploading, then finally invoke a safe shutdown when all data has been uploaded.</p>
<div class="image">
<img src="statemachine.png" alt="statemachine.png"/>
<div class="caption">
Statemachine of data recording, network connectivity, and data upload</div></div>
<p> The x728 may operate in certain modes based on the installation of certain jumpers per the x728's user manual. The scripts provided by the libpanda project are based on the jumper settings in the following image. This ensures that the x728 will apply power to the Raspberry Pi when power is re-established, e.g. when starting a car. This jumper is labelled on the x728 PCB as "Auto SD". The "Auto On" feature appears to leave the Raspberry Pi powered after a shutdown event, which is why a jumper should not be installed in this location. The "Lan PWR" jumper allows for power to be applied to the ethernet port for WOL funcitonality which is not needed for this porject. Also, the x728 ships with a small USB cable for a built-in USB-Ethernet adapter. Again, since WOL is not needed for the CIRCLES project, this cable does not need ot be installed.</p>
<div class="image">
<img src="x725jumper.png" alt="x725jumper.png"/>
<div class="caption">
x725 jumper settings</div></div>
<p> To install the x728 software for the above state machine, navigate to the installation directory for the x728. Then, invoke the installation script.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ cd libpanda/scripts/x725</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ sudo ./install.sh</div></div><!-- fragment --><p>This installation process involves the compilation of two C programs, installs a script to invoke a system shutdown, and installs two systemd services.</p>
<ul>
<li>x725shutdown.sh is installed as /usr/local/sbin/x725shutdown. When called, this operates the GPIO pins to invoke a shutdown.</li>
<li>x725button.service is a systemd script that invokes the C program, x725button. This listens to the GPIO for an invoked shutdown command, then calls a "poweroff".</li>
<li>x725power.service is a systemd script that invokes the C program, x725power. This monitors the charging/discharging state. If power disconnect event occurs, user-defined script is invoked, followed by a call to "x725shutdown".</li>
</ul>
<p>To manually invoke a system shutdown:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo x725shutdown</div></div><!-- fragment --><p>Invoking the shutdown works by signaling to the x728 that a shutdown is taking place, at which the x728 signals back to the Pi via GPIO that a shutdown should take place. The x725button service listens for this and invokes the shutdown automatically. To check on the systemd button status:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ systemctl status x725button</div></div><!-- fragment --><p>The x728 script is automatically invoked based on the power conditions as measured by the x725power service. These conditions include a power input interrupt, low battery voltage, or low battery capacity. The overall flow of signals is therefore:</p>
<p>x725power -&gt; x725shutdown -&gt; x725button</p>
<p>Again, the status may be checked with systemctl:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ systemctl status x725power</div></div><!-- fragment --><p>If you desire to not have the system automatically shutdown upon, such as for when you are debugging the car during starting and stopping the engine, then disable the x725power script:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo systemctl stop x725power</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ sudo systemctl disable x725power</div></div><!-- fragment --><p>To return to normal operation:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo systemctl restart x725power</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ sudo systemctl enable x725power</div></div><!-- fragment --><p><a class="anchor" id="network-guide"></a> </p><hr/>
 <h1>Network Guide</h1>
<p>The directory libpanda/scripts/pi4wifi provides a set of installation scripts for the automatic connection of WiFi for future automatic data uploading. When a known wifi Access Point (AP) is not available, then the scripts with generate an AP for easy connection with a phone or laptop for Raspberry Pi debugging. A very high level view of these scripts in the form of a state machine is as follows:</p>
<div class="image">
<img src="wifistate.png" alt="wifistate.png"/>
<div class="caption">
State machine of the wifi handler</div></div>
<p> The pi4wifi directory has an installation script for easy setup. Simply run this script for installation of dependencies, along with the removal of confliciting packages. The main script is called "crazypifi.sh" and is dependent on hostapd, isc-dhcp-server, wpa_supplicant, iw, and ifupdown. On Ubuntu 18.04, netplan is the default network interface manager but needs to be removed for the use of ifupdown. Please make a note of this if you need netplan for other applications. Again, running the install.sh script will handle all of installation needed.</p>
<p>During installation you will be asked to enter a WiFi SSID and passphrase. It is not checked upon entering, so if you have connection issues you may need to correct your passphrase later. The passphrase and SSID are stored in a wpa_supplicant configuration file, specifically you may edit known wifi SSIDs and passphrases using nano as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo nano /etc/wpa_supplicant/wpa_supplicant.conf</div></div><!-- fragment --><p>The installation script also installs crazypifi.sh as a service, called crazypifi. As with the prior service scripts covered above, you may use systemctl to check the status, stop/start/restart the service, or enable/disable on boot:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ systemctl status crazypifi</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ sudo systemctl stop crazypifi</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$ sudo systemctl start crazypifi</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;$ sudo systemctl restart crazypifi</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;$ sudo systemctl disable crazypifi</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;$ sudo systemctl enable crazypifi</div></div><!-- fragment --><p><a class="anchor" id="visualization"></a> </p><hr/>
 <h1>Data Visualization</h1>
<p>Data visualization is currently handled by <a href="https://github.com/jmscslgroup/strym">Strym</a>.</p>
<p>A tutorial for <a class="el" href="class_strym.html">Strym</a> can be found <a href="https://github.com/jmscslgroup/strym/blob/master/notebook/strymread_example.ipynb">here</a>.</p>
<p> 
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/w2p1uYmHBPA?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>
</p>
<p><a class="anchor" id="repository"></a> </p><hr/>
 <h1>Data Repository</h1>
<p>Currently all data is intended to be uploaded to <a href="https://cyverse.org">CyVerse</a>. In order to acess data we need to grant you access in an account-by-account basis. Please request access from someone at the JMS CSL Group. Currently data is manually uploaded to CyVerse directly from the Pi 4, but with manual commands at the end of each colleciton session. Eventually we will provide methods to perform uploads automatically. This is also why the power supply has yet to be determined for the Pi 4, since power needs to remain after the car is shut off to give time for the Pi to connect to wifi and transfer data.</p>
<p>To access Cyverse data after you have created an account and have been granted access:</p>
<ol type="1">
<li>Log into CyVerse, then open the discovery environment. <div class="image">
<img src="cyverse.jpg" alt="cyverse.jpg"/>
<div class="caption">
CyVerse Discovery Environment</div></div>
</li>
<li>Click on the "Data" square in the top left in the environment.</li>
<li>Navigate to Shared With Me-&gt;rahulbhadani-&gt;Jmscslgroup-&gt;PandaData <div class="image">
<img src="cyversedata.jpg" alt="cyversedata.jpg"/>
<div class="caption">
Cyverse Discovery Environment data navigation</div></div>
</li>
<li>All data is timestamped in folders. You can download data by clicking on the Download dorp down menu at the top. Alternatively, the discovery environment lets you preview data once selected.</li>
</ol>
<blockquote class="doxtable">
<p>Note: Data between different days may show to have inconsistent formatting due to the development process of data collection. Also, some data may be available along with a video of the collection session that may be used for data evaluation.</p>
</blockquote>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jun 3 2021 22:19:03 for libpandac by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
